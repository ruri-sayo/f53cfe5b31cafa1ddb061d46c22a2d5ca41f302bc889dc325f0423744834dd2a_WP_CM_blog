# Astroサイト ローカルテストガイド

## 概要

デプロイ前にローカル環境でサイトの動作を確認する方法を説明します。

---

## 前提条件

- Node.js v18以上がインストールされていること
- `astro-site/` ディレクトリに移動していること

```bash
cd astro-site
```

---

## テスト方法

### 1. 開発サーバー (Hot Reload)

開発中に使用。ファイル変更が即座に反映されます。

```bash
npm run dev
```

- アクセス: `http://localhost:4321/`
- 終了: `Ctrl + C`

**特徴**:
- ホットリロード対応（ファイル保存で自動更新）
- エラーがブラウザに表示される
- 開発時に推奨

---

### 2. 本番ビルド + プレビュー

デプロイ前の最終確認に使用。本番環境と同じ状態を確認できます。

```bash
npm run build    # ビルド実行
npm run preview  # プレビューサーバー起動
```

- アクセス: `http://localhost:4321/[base]/`
  - 例: `http://localhost:4321/f53cfe5b31cafa1ddb061d46c22a2d5ca41f302bc889dc325f0423744834dd2a_WP_CM_blog/`
- 終了: `Ctrl + C`

**特徴**:
- 本番ビルドと同じ出力を確認
- `base` 設定が反映される
- デプロイ前の最終確認に推奨

---

## テストチェックリスト

### 基本動作

- [ ] トップページが正常に表示される
- [ ] ヘッダー/フッターが表示される
- [ ] ナビゲーションリンクが機能する
- [ ] モバイルメニューが動作する

### 記事関連

- [ ] 記事一覧ページが表示される
- [ ] 記事詳細ページが表示される
- [ ] 記事内の画像が表示される
- [ ] コードブロックがシンタックスハイライトされる

### Novel機能

- [ ] Novelシリーズ一覧が表示される
- [ ] シリーズトップページでエピソード一覧が表示される
- [ ] エピソードページが表示される
- [ ] 表示設定UIが動作する

### ツール

- [ ] ツール一覧ページが表示される
- [ ] 文字数カウンター (React版) が動作する
- [ ] Diff比較ツール (React版) が動作する
- [ ] 既存HTMLツールが動作する

### ゲーム

- [ ] ゲーム一覧ページが表示される
- [ ] 各ゲームページにアクセスできる

### 固定ページ

- [ ] Aboutページが表示される
- [ ] Contactページが表示される
- [ ] 404ページが表示される（存在しないURLでテスト）

### レスポンシブ

- [ ] デスクトップ表示が正常
- [ ] タブレット表示が正常
- [ ] スマートフォン表示が正常

---

## よくある問題と解決策

### ビルドエラー: Content Collection

```
Error: Unable to parse content collection entry
```

**原因**: Markdownファイルのフロントマターに不正な値がある

**解決**: 該当ファイルを確認し、フロントマターを修正

---

### ビルドエラー: Shiki言語

```
[Shiki] The language "XXX" doesn't exist
```

**原因**: コードブロックの言語指定が不正

**解決**: 対応する言語IDに修正（例: `C` → `c`）

---

### 404エラー (プレビュー時)

**原因**: `base` 設定が反映されていない

**解決**: 
1. `astro.config.mjs` の `base` 設定を確認
2. プレビュー時は `http://localhost:4321/[base]/` でアクセス

---

### Reactコンポーネントが動作しない

**原因**: `client:load` ディレクティブが不足

**解決**: Astroページで `<Component client:load />` と指定

---

## ビルド出力の確認

ビルド後の出力ファイルを確認:

```bash
ls -la dist/
```

主要な出力:
- `dist/index.html` - トップページ
- `dist/posts/` - 記事ページ
- `dist/novel/` - 小説ページ
- `dist/tools/` - ツールページ
- `dist/assets/` - 静的アセット
- `dist/_astro/` - Astro生成JS/CSS

---

## テスト自動化（将来）

将来的にPlaywrightやCypressによるE2Eテストを導入する場合:

```bash
npm install -D @playwright/test
npx playwright test
```

---

## 参考コマンド一覧

| コマンド | 説明 |
|---|---|
| `npm run dev` | 開発サーバー起動 |
| `npm run build` | 本番ビルド |
| `npm run preview` | ビルド後プレビュー |
| `npm run astro check` | TypeScript/Astro構文チェック |

---

**最終更新**: 2026-01-03
