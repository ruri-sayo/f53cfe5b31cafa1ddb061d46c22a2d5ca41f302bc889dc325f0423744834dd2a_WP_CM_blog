<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テキスト差分比較ツール</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interフォントの読み込み */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* ラインマーカー風のハイライトスタイル */
        .highlight-red {
            background: linear-gradient(transparent 60%, #ffcccb 60%);
        }
        .highlight-green {
            background: linear-gradient(transparent 60%, #90ee90 60%);
        }
        /* スクロール同期のためのカスタムCSS */
        .sync-scroll {
            overflow: auto;
            -ms-overflow-style: none; /* IE, Edge */
            scrollbar-width: none; /* Firefox */
        }
        .sync-scroll::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">テキスト差分比較ツール</h1>
            <p class="mt-2 text-gray-600">2つのテキストを入力して、行ごとの違いを確認します。</p>
        </header>

        <main>
            <!-- 入力エリア -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                <div>
                    <label for="inputA" class="block text-lg font-medium mb-2">入力 A</label>
                    <textarea id="inputA" class="w-full h-64 p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150" placeholder="比較したいテキストを入力してください..."></textarea>
                </div>
                <div>
                    <label for="inputB" class="block text-lg font-medium mb-2">入力 B</label>
                    <textarea id="inputB" class="w-full h-64 p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-150" placeholder="比較対象のテキストを入力してください..."></textarea>
                </div>
            </div>

            <!-- 比較ボタン -->
            <div class="mt-6 text-center">
                <button id="compareBtn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition duration-300 ease-in-out transform hover:-translate-y-1 shadow-lg">
                    比較を実行
                </button>
            </div>

            <!-- 結果表示エリア -->
            <div id="result-container" class="mt-10 hidden">
                <h2 class="text-2xl font-bold text-center mb-6">比較結果</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 bg-white p-4 rounded-lg shadow-md border">
                     <div>
                        <h3 class="text-xl font-semibold mb-2 border-b pb-2">Aの結果</h3>
                        <div id="outputA" class="w-full h-96 p-3 bg-gray-50 rounded-md whitespace-pre-wrap font-mono text-sm leading-relaxed sync-scroll"></div>
                    </div>
                     <div>
                        <h3 class="text-xl font-semibold mb-2 border-b pb-2">Bの結果</h3>
                        <div id="outputB" class="w-full h-96 p-3 bg-gray-50 rounded-md whitespace-pre-wrap font-mono text-sm leading-relaxed sync-scroll"></div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>&copy; 2024 テキスト差分比較ツール</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const inputA = document.getElementById('inputA');
            const inputB = document.getElementById('inputB');
            const compareBtn = document.getElementById('compareBtn');
            const outputA = document.getElementById('outputA');
            const outputB = document.getElementById('outputB');
            const resultContainer = document.getElementById('result-container');

            // 左右の結果表示エリアのスクロールを同期させる
            let isSyncing = false;
            outputA.addEventListener('scroll', () => {
                if (!isSyncing) {
                    isSyncing = true;
                    outputB.scrollTop = outputA.scrollTop;
                    isSyncing = false;
                }
            });

            outputB.addEventListener('scroll', () => {
                if (!isSyncing) {
                    isSyncing = true;
                    outputA.scrollTop = outputB.scrollTop;
                    isSyncing = false;
                }
            });


            compareBtn.addEventListener('click', () => {
                const textA = inputA.value;
                const textB = inputB.value;

                // 差分を比較して表示
                compareTexts(textA, textB);
                
                // 結果コンテナを表示
                resultContainer.classList.remove('hidden');
            });

            function compareTexts(textA, textB) {
                const linesA = textA.split('\n');
                const linesB = textB.split('\n');
                const maxLines = Math.max(linesA.length, linesB.length);

                let htmlA = '';
                let htmlB = '';

                for (let i = 0; i < maxLines; i++) {
                    const lineA = linesA[i];
                    const lineB = linesB[i];
                    const lineNum = i + 1;

                    // 行番号のプレフィックスを作成
                    const prefixA = `<span class="text-gray-400 select-none w-10 inline-block text-right pr-2">${lineNum}</span>`;
                    const prefixB = `<span class="text-gray-400 select-none w-10 inline-block text-right pr-2">${lineNum}</span>`;
                    const emptyPrefix = `<span class="text-gray-400 select-none w-10 inline-block text-right pr-2"> </span>`;
                    const emptyLine = `<div class="h-[21px]">${emptyPrefix}</div>`; // 高さを合わせるための空行


                    if (lineA === undefined) {
                        // Bにのみ存在する行
                        htmlA += emptyLine;
                        htmlB += `<div>${prefixB}<span class="highlight-green">${escapeHtml(lineB)}</span></div>`;
                    } else if (lineB === undefined) {
                        // Aにのみ存在する行
                        htmlA += `<div>${prefixA}<span class="highlight-green">${escapeHtml(lineA)}</span></div>`;
                        htmlB += emptyLine;
                    } else if (lineA === lineB) {
                        // 完全に一致する行
                        htmlA += `<div>${prefixA}<span>${escapeHtml(lineA)}</span></div>`;
                        htmlB += `<div>${prefixB}<span>${escapeHtml(lineB)}</span></div>`;
                    } else {
                        // 食い違っている行
                        htmlA += `<div>${prefixA}<span class="highlight-red">${escapeHtml(lineA)}</span></div>`;
                        htmlB += `<div>${prefixB}<span class="highlight-red">${escapeHtml(lineB)}</span></div>`;
                    }
                }

                outputA.innerHTML = htmlA;
                outputB.innerHTML = htmlB;
            }

            // HTMLエスケープ関数
            function escapeHtml(text) {
                if (text === null || text === undefined) return '';
                // 半角スペースを &nbsp; に変換して、行頭のインデントを維持する
                // タブ文字もスペース4つに変換する
                return text
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;")
                    .replace(/\t/g, '    ')
                    .replace(/ /g, '&nbsp;');
            }
        });
    </script>
</body>
</html>
